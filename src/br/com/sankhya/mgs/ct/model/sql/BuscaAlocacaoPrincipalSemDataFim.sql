SELECT   NUALOCAPS
  FROM   MGSTCTALOCACAOPS
 WHERE       MATRICULA = :MATRICULA
         AND CODEVENTO IN (SELECT CODEVENTO FROM AD_TGFECUS WHERE TIPOPOSTO = 'PS')
         AND ( (TRUNC (:DTI) >= TRUNC (DTINICIO) AND TRUNC (DTFIM) IS NULL) OR TRUNC(DTINICIO) > TRUNC (:DTI))
